# FP8 Flash Attention - Resource & Scaling

## Current Implementation

| Parameter | Value |
|-----------|-------|
| Head Dim | 128 |
| Seq Len | 32 (single tile) |
| Data Type | FP8 e4m3 input, F32 accum |

---

## Resource Usage

### VGPRs (68 / 256)

| Range | Purpose |
|-------|---------|
| v0-v19 | Addresses, temps, softmax state |
| v32-v47 | S/P matrix |
| v48-v63 | O accumulator |
| v64-v67 | MFMA operands |

### SGPRs (24 / 102)

| Range | Purpose |
|-------|---------|
| s0-s1 | Kernel args |
| s2-s3 | Constants (log2e, -inf) |
| s4-s23 | Pointers, descriptors |

### LDS (8KB / 64KB)

| Offset | Size | Content |
|--------|------|---------|
| 0x0000 | 4KB | P[32×32] F32 |
| 0x1000 | 4KB | V[32×128] FP8 |

---

## Scaling to Longer Sequences

### K-tile Loop Requirements

For seq > 32, loop over K in tiles:
```
for k_tile in range(0, seq_len, 32):
    S_tile = K_tile @ Q^T
    # Online softmax with running max/sum
    O = O * exp(old_max - new_max) + P_tile @ V_tile
```

### Additional Resources

| Resource | +Required |
|----------|-----------|
| VGPRs | +4 (running max/sum) |
| SGPRs | +5 (loop counter, bounds) |
| LDS | Same (reuse per tile) |

---

## Occupancy

| Metric | Value |
|--------|-------|
| VGPRs/wave | 68 |
| Waves/CU | 4 (limited by VGPRs) |
| LDS/wave | 8KB |
